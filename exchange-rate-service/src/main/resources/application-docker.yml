server:
  port: ${SERVER_PORT:8083}

spring:
  application:
    name: exchange-rate-service
  task:
    execution:
      pool:
        core-size: 5
        max-size: 20
        queue-capacity: 100
        keep-alive: 60s
      thread-name-prefix: "async-task-"
      shutdown:
        await-termination: true
        await-termination-period: 30s
  data:
    redis:
      host: ${SPRING_REDIS_HOST:redis}
      port: ${SPRING_REDIS_PORT:6379}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  cache:
    type: redis
    redis:
      time-to-live: 2s
      cache-null-values: false
      key-prefix: "fx:"
      use-key-prefix: true

exchange:
  api:
    url: ${EXCHANGE_API_URL:http://api.fixer.io/v1/latest}
    access-key: ${EXCHANGE_API_ACCESS_KEY:your-api-key-here}
    rate-limit-status-code: ${EXCHANGE_API_RATE_LIMIT_STATUS_CODE:429}
  connect-timeout: 5s
  read-timeout: 30s
  client:
    connect-timeout-ms: ${EXCHANGE_CLIENT_CONNECT_TIMEOUT:3000}
    read-timeout-ms: ${EXCHANGE_CLIENT_READ_TIMEOUT:5000}
    max-attempts: ${EXCHANGE_CLIENT_MAX_ATTEMPTS:2}
    backoff-delay-ms: ${EXCHANGE_CLIENT_BACKOFF_DELAY:500}
    backoff-multiplier: ${EXCHANGE_CLIENT_BACKOFF_MULTIPLIER:1.5}
    max-delay-ms: ${EXCHANGE_CLIENT_MAX_DELAY:10000}
    jitter-factor: ${EXCHANGE_CLIENT_JITTER:0.05}
    circuit-breaker-enabled: ${EXCHANGE_CLIENT_CIRCUIT_BREAKER_ENABLED:true}
    circuit-breaker-failure-threshold: ${EXCHANGE_CLIENT_CIRCUIT_BREAKER_FAILURE_THRESHOLD:3}
    circuit-breaker-timeout-ms: ${EXCHANGE_CLIENT_CIRCUIT_BREAKER_TIMEOUT:30000}
    rate-limit-status-code: ${EXCHANGE_CLIENT_RATE_LIMIT_STATUS_CODE:429}
  user-agent:
    default: "Exchange-Rate-Service/1.0"
  reactive:
    max-retries: ${EXCHANGE_REACTIVE_MAX_RETRIES:2}
    base-delay: ${EXCHANGE_REACTIVE_BASE_DELAY:500}

external-services:
  pool-size: 10
  timeout: 30s

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,prometheus"
  endpoint:
    health:
      show-details: when_authorized
    metrics:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true

resilience4j:
  retry:
    instances:
      exchange-rate-api:
        max-attempts: 3
        wait-duration: 1000ms
        exponential-backoff-multiplier: 2
        randomized-wait-factor: 0.5
  circuitbreaker:
    instances:
      exchange-rate-api:
        failure-rate-threshold: 50
        wait-duration-in-open-state: 30000ms
        sliding-window-size: 10
        minimum-number-of-calls: 5